(function(){var e,t,n,r,o,a,i,l,u,s,f,p,c,d,m,g,h,v,y,b,L,w,E,R,A;for(R=["HTMLCanvasElement","FileReader","FormData","Uint8Array","ArrayBuffer","Blob","URL","Worker"],b=0,w=R.length;w>b;b++)if(r=R[b],!(r in window))return g("Your browser is too old to support ExifExodus. (Missing "+r+" support)"),!1;for(d="exifexodus",p="image/jpeg",f=1,u="data:image/jpeg;base64,".length,n={},l={},v=XMLHttpRequest.prototype.send,h=XMLHttpRequest.prototype.open,a=FormData.prototype.append,i=HTMLFormElement.prototype.submit,A=["readAsDataURL","readAsArrayBuffer","readAsBinaryString","readAsText"],y=function(e){return l[e]=FileReader.prototype[e],FileReader.prototype[e]=function(n,r){return n.type!==p?l[e].call(this,n):t(n,function(t){return function(n){return l[e].call(t,n,r)}}(this))}},L=0,E=A.length;E>L;L++)c=A[L],y(c);XMLHttpRequest.prototype.send=function(e){var n,r,o,i,l,u,s,f,p,c;if(e instanceof FormData&&e[d]){o=[],n=new FormData,c=e[d];for(i in c)u=c[i],u.file&&u.file instanceof File?o.push(u):a.call(n,i,u);if(o.length){for(l=o.length,s=function(e){return function(r){return t(r.file,function(t){return a.call(n,r.name,t,r.filename),--l?void 0:v.call(e,n)})}}(this),f=0,p=o.length;p>f;f++)r=o[f],s(r);return void 0}return v.apply(this,arguments)}return v.apply(this,arguments)},XMLHttpRequest.prototype.open=function(e,t){return"blob:"!==(null!=t?t.slice(0,5):void 0)?h.apply(this,arguments):void 0},FormData.prototype.append=function(e,t,n){var r;return this[d]||(this[d]={}),this[d][e]=t instanceof File?(r={},r[d]={name:e,file:t,filename:n}):t,a.apply(this,arguments)},HTMLFormElement.prototype.submit=function(){return m.call(this)},"toBlob"in HTMLCanvasElement.prototype||(o=function(){return self.onmessage=function(e){var t,n,r,o,a;for(t=e.data,r=t.length,o=new Uint8Array(new ArrayBuffer(r)),n=a=0;r>=0?r>a:a>r;n=r>=0?++a:--a)o[n]=t.charCodeAt(n);return self.postMessage(new Blob([o.buffer],{type:"image/jpeg"})),self.close()}},e=URL.createObjectURL(new Blob(["("+o.toString()+")()"],{type:"application/javascript"}))),t=function(t,n){var r;return r=new FileReader,r.addEventListener("load",function(){var t;return t=new Image,t.addEventListener("load",function(){var r,o,a,i;return a=t.width,o=t.height,r=document.createElement("canvas"),r.width=a,r.height=o,r.getContext("2d").drawImage(t,0,0,a,o),r.getContext("2d").fillStyle="rgb(255,0,255)",r.getContext("2d").fillRect(0,0,a,o),r.toBlob?r.toBlob(n,p,f):(i=new Worker(e),i.onmessage=function(e){return n(e.data)},i.postMessage(atob(r.toDataURL(p,f).slice(u))))}),t.src=r.result}),l.readAsDataURL.call(r,t)},m=function(e){var r,o,l,u,s,f,c,d,m,y,b,L,w,E,R,A,F,M;for(c=e instanceof Event,l=c?e.target:this,f=l.querySelectorAll("input"),m=[],n=[],u=new FormData,b=0,w=f.length;w>b;b++)if(s=f[b],s.value)if("file"===s.type)for(F=s.files,L=0,E=F.length;E>L;L++)o=F[L],o.type===p&&m.push({file:o,name:s.name});else a.call(u,s.name,s.value);if(!m.length)return void(c||i.call(this));if(c&&(e.preventDefault(),e.stopImmediatePropagation()),!(r=l.getAttribute("action")))return g("Can't proceed, the upload form has no action URL.",n);for(y=m.length,M=[],A=0,R=m.length;R>A;A++)d=m[A],M.push(function(e){return t(e.file,function(t){var o;return n.push(t),a.call(u,e.name,t,e.file.name),--y?void 0:(o=new XMLHttpRequest,o.onreadystatechange=function(){var e,t,r;return 4===o.readyState?200>=(t=o.status)&&300>t?"document"===o.responseType||/<[\w\W]*>/.test(o.responseText)?(e=l.getAttribute("target"))&&"_blank"!==e&&"_self"!==e&&"_parent"!==e&&"_top"!==e?null!=(r=document.getElementById(e))?r.innerHTML=o.response:void 0:document.write(o.response):g("Uploaded image but received ambiguous response from server.",n):g("Attempted upload of EXIF-free images but received an error response from the server (code "+o.status+").",n):void 0},o.onerror=function(){return g("Something went wrong submitting the upload form.",n)},h.call(o,l.getAttribute("method")||"GET",r),v.call(o,u))})}(d));return M},g=function(e,t){var n,r,o;if(!t)return alert("ExifExodus: "+e);if(confirm("ExifExodus: "+e+" Click OK to open your EXIF-free images in new tabs.")){for(r=0,o=t.length;o>r;r++)n=t[r],open(URL.createObjectURL(n),"_blank");return null}},s=function(){return addEventListener("submit",m,!0)},"complete"===document.readyState?s():document.addEventListener("DOMContentLoaded",s)}).call(this);